<html
    class="a-ws a-js a-audio a-video a-canvas a-svg a-drag-drop a-geolocation a-history a-webworker a-autofocus a-input-placeholder a-textarea-placeholder a-local-storage a-gradients a-hires a-transform3d a-touch-scrolling a-text-shadow a-text-stroke a-box-shadow a-border-radius a-border-image a-opacity a-transform a-transition"
    data-aui-build-date="3.17.16.3-2017-10-11" lang="en">

<head>
    <link href="https://d1lcia0inyjsq.cloudfront.net/20230404192231/css/bootstrap.min.css" media="screen"
        rel="stylesheet">
    <link href="https://d1lcia0inyjsq.cloudfront.net/20230404192231/css/cognito-login.css" media="screen"
        rel="stylesheet">
    <link
        href="https://d1lcia0inyjsq.cloudfront.net/us-east-2_YEdHSQGXQ/4m75d6si1cliiedqmme4pguvnf/20240415121615/assets/CSS/custom-css.css"
        media="screen" rel="stylesheet" />
    <title>Liliput Home</title>

    <link href="data:image/png;base64, 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" rel="icon" alt="Icon">
    <style>
        .lds-ellipsis {
            color: #ffaf07
        }

        .lds-ellipsis,
        .lds-ellipsis div {
            box-sizing: border-box;
        }

        .lds-ellipsis {
            display: inline-block;
            position: relative;
            width: 10px;
            height: 10px;
        }

        .lds-ellipsis div {
            position: absolute;
            margin-left: -35px;
            top: 0px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: currentColor;
            animation-timing-function: cubic-bezier(0, 1, 1, 0);
        }

        .lds-ellipsis div:nth-child(1) {
            left: 8px;
            animation: lds-ellipsis1 0.6s infinite;
        }

        .lds-ellipsis div:nth-child(2) {
            left: 8px;
            animation: lds-ellipsis2 0.6s infinite;
        }

        .lds-ellipsis div:nth-child(3) {
            left: 32px;
            animation: lds-ellipsis2 0.6s infinite;
        }

        .lds-ellipsis div:nth-child(4) {
            left: 56px;
            animation: lds-ellipsis3 0.6s infinite;
        }

        @keyframes lds-ellipsis1 {
            0% {
                transform: scale(0);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes lds-ellipsis3 {
            0% {
                transform: scale(1);
            }

            100% {
                transform: scale(0);
            }
        }

        @keyframes lds-ellipsis2 {
            0% {
                transform: translate(0, 0);
            }

            100% {
                transform: translate(24px, 0);
            }
        }
    </style>

    <title>Liliput</title>

    <script>
        const bufferToBase64UrlEncoded = (input) => {
            const bytes = new Uint8Array(input);
            return urlEncodeBase64(window.btoa(String.fromCharCode(...bytes)));
        }

        const urlEncodeBase64 = (input) => {
            const chars = { '+': '-', '/': '_', '=': '' };
            return input.replace(/[\+\/=]/g, m => chars[m]);
        }

        const generateCode = (length) => {
            const charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';

            let result = '';
            for (let i = 0; i < length; i++) {
                const randomIndex = Math.floor(Math.random() * charset.length);
                result += charset.charAt(randomIndex);
            }

            return crypto.randomUUID() + result;
        }

        const generateCodeChallenge = async (codeChallengeMethod, codeVerifier) => {
            let digest = await crypto.subtle.digest(codeChallengeMethod, new TextEncoder().encode(codeVerifier));
            return bufferToBase64UrlEncoded(digest);
        }

        const saveCodePairToSessionStorage = (codeVerifier, codeChallenge) => {
            sessionStorage.setItem('codeVerifier', codeVerifier);
            sessionStorage.setItem('codeChallenge', codeChallenge);
        }


        const createCodePair = async () => {
            // A cryptographically random string that is used to correlate the authorization request to the token request.
            let codeVerifier = generateCode(128);

            // A method that was used to derive code challenge
            let codeChallengeMethod = 'SHA-256';

            // A challenge derived from the code verifier that is sent in the authorization request, to be verified against later.
            let codeChallenge = await generateCodeChallenge(codeChallengeMethod, codeVerifier);
            saveCodePairToSessionStorage(codeVerifier, codeChallenge);
        }

        const eraseText = () => {
            document.getElementById("message-txt-1").innerHTML = "";
            document.getElementById("message-txt-2").innerHTML = "";
            document.querySelectorAll('.lds-ellipsis').forEach(function (element) {
                element.style.display = '';
            });
        }

        const hideLoader = () => {
            document.querySelectorAll('.lds-ellipsis').forEach(function (element) {
                element.style.display = 'none';
            });
        }

        const showText = (message) => {
            hideLoader();
            document.getElementById("message-txt-1").innerHTML = message;
            document.getElementById("message-txt-2").innerHTML = message;
        };

        const shortLinkUrl = (shortLink) => {
            let path = window.location.pathname;
            if (!path.endsWith('/')) {
                path = path + '/';
            }
            let baseUrl = `${window.location.protocol}//${window.location.host}${path}`;
            let url = `${baseUrl}l/${shortLink}`;
            return url;
        }

        const focusOnInput = () => {
            document.querySelectorAll('.link-input-element').forEach(elem => { if(elem.checkVisibility()) { elem.focus(); }});
        }

        const createLink = async (event) => {
            event.preventDefault(); // Prevent the default form submission
            let inputValue = event.target.elements['link-input-field'].value;
            eraseText();

            let response = await fetch('/link', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ link: inputValue })
            });

            if (response.ok) {
                let responseBody = await response.json();
                let shortLink = shortLinkUrl(responseBody.shortLink);
                showText(`Here's your short link <a target="_blank" href=${shortLink}>${shortLink}</a>`);
                focusOnInput();
            } else {
                if (response.status == 403 || response.status == 401) {
                    await oauthLogin();
                } else {
                    showText(`Please submit a valid link!`);
                }
            }

            event.srcElement.elements.inputLink.value = '';
        }

        const oauthLogin = async () => {
            var currentTime = new Date().getTime();
            var lastExecutionTime = localStorage.getItem('lastExecutionTime');
            if (!lastExecutionTime || (currentTime - lastExecutionTime > 5000)) {
                await createCodePair();
                let codeChallenge = sessionStorage.getItem('codeChallenge');
                let redirectUri = "https%3A%2F%2Fliliput.mourjo.me";
                window.location.href = `https://auth.liliput.mourjo.me/oauth2/authorize?client_id=4m75d6si1cliiedqmme4pguvnf&response_type=code&scope=email+openid+phone&redirect_uri=${redirectUri}&code_challenge_method=S256&code_challenge=${codeChallenge}`;
                localStorage.setItem('lastExecutionTime', currentTime);
            }
        }

        const removeCodeFromUrl = () => {
            let currentUrl = window.location.href;
            let baseUrl = currentUrl.split('?')[0];
            window.history.replaceState({}, document.title, baseUrl);
        }

        const removeProtocol = (url) => {
            if (url.startsWith("http://")) {
                return url.substring(7);
            } else if (url.startsWith("https://")) {
                return url.substring(8);
            } else {
                return url;
            }
        }

        const displayLinks = (links) => {
            if (links.length > 0) {
                document.querySelectorAll('.links-table').forEach(function (element) {
                    element.style.display = '';
                });

                let tbody = '';
                let maxLength = window.innerWidth > 992 ? 40 : 10;

                for (let link of links) {
                    let row = '<tr>';
                    row += '<td>';
                    let url = shortLinkUrl(link.shortLink);
                    row += `<a target="_blank" href=${url}>${link.shortLink}</a>`;
                    row += '</td>';
                    row += '<td>';

                    let originalLinkDisplay = removeProtocol(link.originalLink);
                    let truncatedLink = originalLinkDisplay.substring(0, Math.min(maxLength, originalLinkDisplay.length)) + (originalLinkDisplay.length > maxLength ? '...' : '');
                    row += `<a target="_blank" href=${url}>${truncatedLink}</a>`;
                    row += '</td>';
                    row += '<td>';
                    row += link.usageCount;
                    row += '</td>';
                    row += '</tr>';
                    tbody += row;
                }

                document.querySelectorAll('.links-table-body').forEach(function (element) {
                    element.innerHTML = tbody;
                });
            }
        }

        const showLinks = async () => {
            await fetch('/links', {
                method: 'GET'
            }).then(async response => {
                if (response.ok) {
                    let r = await response.json();
                    displayLinks(r.links);
                }
            });
        }


        window.onload = () => {
            eraseText();
            let isCalledBack = /^\?code=[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(window.location.search);

            if (isCalledBack) {

                let code = new URL(window.location).searchParams.get('code');
                let codeVerifier = sessionStorage.getItem('codeVerifier');

                fetch('/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ code: code, codeVerifier: codeVerifier })
                }).then(async response => {
                    if (response.ok) {
                        let r = await response.json();
                        await showLinks();
                        showText('Welcome, ' + r['userEmail']);
                        removeCodeFromUrl();
                        focusOnInput();
                    } else {
                        await oauthLogin();
                        focusOnInput();
                    }
                });

            } else {
                fetch('/links', {
                    method: 'GET'
                }).then(async response => {
                    if (!response.ok) {
                        await oauthLogin();
                    } else {
                        let r = await response.json();
                        showText('Welcome back, ' + r['userEmail']);
                        removeCodeFromUrl();
                        focusOnInput();
                        displayLinks(r.links);
                    }
                });
            }
        }


    </script>

    <meta content="width=device-width, initial-scale=1" name="viewport">
</head>

<body spellcheck="false">
    <div class="container">
        <div class="modal-dialog">
            <div class="modal-content background-customizable modal-content-mobile visible-xs visible-sm">
                <div>
                    <div>
                        <div class="banner-customizable">
                            <center>
                                <img alt="logo" class="logo-customizable"
                                    src="https://d1lcia0inyjsq.cloudfront.net/us-east-2_YEdHSQGXQ/4m75d6si1cliiedqmme4pguvnf/20240415124148/assets/images/image.jpg">
                            </center>
                        </div>
                    </div>
                </div>
                <div class="modal-body">
                    <div>
                        <div>

                        </div>
                    </div>
                    <div>
                        <div>
                            <div>
                                <div class="col-sm-12 col-xs-12">
                                    <center>
                                        <div class="lds-ellipsis">
                                            <div></div>
                                            <div></div>
                                            <div></div>
                                            <div></div>
                                        </div>
                                    </center>
                                </div>
                                <div class="textDescription-customizable " id="message-txt-1"></div>

                                <form method="POST" onsubmit="createLink(event)" style="margin-bottom: 0px">
                                    <div>
                                        <input autocapitalize="none" class="link-input-element form-control inputField-customizable"
                                            id="inputLink-1" placeholder="Let's shorten a link!" required="" type="text" name="link-input-field">
                                    </div>

                                    <input aria-label="submit" class="btn btn-primary submitButton-customizable"
                                        name="submitButton" type="Submit" value="Create Link">
                                    <br>
                                </form>

                                <table class="table links-table" style="display: none;">
                                    <thead>
                                        <tr>
                                            <th>Short Link</th>
                                            <th>Original Link</th>
                                            <th>Usage Count</th>
                                        </tr>
                                    </thead>
                                    <tbody class="links-table-body">
                                    </tbody>
                                </table>
                                <hr style="margin-left: 0px; margin-right: 0px; margin-top:10px; margin-bottom: 10px;"/>
                                <div class="text-center text-muted">
                                    <i>Mourjo Sen - <a target="_blank" href="https://github.com/mourjo/liliput">github.com/mourjo/liliput</a></i> 
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-content background-customizable modal-content-desktop visible-md visible-lg">
                <div>
                    <div>
                        <div class="banner-customizable">
                            <center>
                                <img alt="logo" class="logo-customizable"
                                    src="https://d1lcia0inyjsq.cloudfront.net/us-east-2_YEdHSQGXQ/4m75d6si1cliiedqmme4pguvnf/20240415124148/assets/images/image.jpg">
                            </center>
                        </div>
                    </div>
                </div>


                <div class="modal-body">
                    <div>
                        <div>

                        </div>
                    </div>
                    <div>

                        <div class="panel col-md-12 col-lg-12">

                            <div>
                                <div>
                                    <div class="col-md-12 col-lg-12">
                                        <center>
                                            <div class="lds-ellipsis">
                                                <div></div>
                                                <div></div>
                                                <div></div>
                                                <div></div>
                                            </div>
                                        </center>
                                    </div>
                                    <div class="textDescription-customizable " id="message-txt-2"></div>

                                    <form method="POST" onsubmit="createLink(event)" style="margin-bottom: 0px">
                                        <div>
                                            <input autocapitalize="none" class="link-input-element form-control inputField-customizable"
                                                id="inputLink-2" placeholder="Let's shorten a link!" required=""
                                                type="text" name="link-input-field">
                                        </div>

                                        <input aria-label="submit" class="btn btn-primary submitButton-customizable"
                                            name="submitButton" type="Submit" value="Create Link">
                                        <br>
                                    </form>
                                    <table class="table links-table" style="display: none;">
                                        <thead>
                                            <tr>
                                                <th>Short Link</th>
                                                <th>Original Link</th>
                                                <th>Usage Count</th>
                                            </tr>
                                        </thead>
                                        <tbody class="links-table-body">
                                        </tbody>
                                    </table>
                                    <hr style="margin-left: 0px; margin-right: 0px; margin-top:10px; margin-bottom: 10px;"/>
                                    <div class="text-center text-muted">
                                         <i>Mourjo Sen - <a target="_blank" href="https://github.com/mourjo/liliput">github.com/mourjo/liliput</a></i> 
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="fwcim-container"></div>
</body>

</html>
